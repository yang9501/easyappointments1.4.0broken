window.BackendCalendarGoogleSync=window.BackendCalendarGoogleSync||{},function(){"use strict";function e(){$("#enable-sync").on("click",function(){var e,l,n,o,a,i,t,c,s;!1===$("#enable-sync").hasClass("enabled")?(e=GlobalVariables.baseUrl+"/index.php/google/oauth/"+$("#select-filter-item").val(),l=GlobalVariables.baseUrl+"/index.php/google/oauth_callback",n=window.open(e,"Authorize Easy!Appointments","width=800, height=600"),o=window.setInterval(function(){try{var e,a;n.document&&-1!==n.document.URL.indexOf(l)&&(n.close(),window.clearInterval(o),$("#enable-sync").addClass("btn-secondary enabled").removeClass("btn-light"),$("#enable-sync span").text(EALang.disable_sync),$("#google-sync").prop("disabled",!1),$("#select-filter-item option:selected").attr("google-sync","true"),e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_get_google_calendars",a={csrfToken:GlobalVariables.csrfToken,provider_id:$("#select-filter-item").val()},$.post(e,a).done(function(e){$("#google-calendar").empty(),e.forEach(function(e){$("#google-calendar").append(new Option(e.summary,e.id))}),$("#select-google-calendar").modal("show")}))}catch(e){}},100)):(a=$("#select-filter-item").val(),(i=GlobalVariables.availableProviders.find(function(e){return Number(e.id)===Number(a)})).settings.google_sync="0",i.settings.google_token=null,t=i.id,c=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_disable_provider_sync",s={csrfToken:GlobalVariables.csrfToken,provider_id:t},$.post(c,s),$("#enable-sync").removeClass("btn-secondary enabled").addClass("btn-light"),$("#enable-sync span").text(EALang.enable_sync),$("#google-sync").prop("disabled",!0),$("#select-filter-item option:selected").attr("google-sync","false"))}),$("#select-calendar").on("click",function(){var e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_select_google_calendar",a={csrfToken:GlobalVariables.csrfToken,provider_id:$("#select-filter-item").val(),calendar_id:$("#google-calendar").val()};$.post(e,a).done(function(){Backend.displayNotification(EALang.google_calendar_selected),$("#select-google-calendar").modal("hide")})}),$("#google-sync").on("click",function(){var e=GlobalVariables.baseUrl+"/index.php/google/sync/"+$("#select-filter-item").val();$.ajax({url:e,type:"GET",dataType:"json"}).done(function(e){Backend.displayNotification(EALang.google_sync_completed),$("#reload-appointments").trigger("click")}).fail(function(e,a,l){Backend.displayNotification(EALang.google_sync_failed)})})}window.BackendCalendarGoogleSync.initialize=function(){e()}}();